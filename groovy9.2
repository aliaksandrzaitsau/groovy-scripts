import jenkins.model.*;
import hudson.model.FreeStyleProject;
import hudson.plugins.git.GitSCM;
import hudson.tasks.Shell;
import javaposse.jobdsl.plugin.*;
import hudson.plugins.ws_cleanup.*

def url = "https://github.com/MNT-Lab/groovy-scripts.git"
def jobName = "test888"


// If jobName exists should delete it
map = Jenkins.instance.getItemMap()
println "DEBUG: map = " + map
if (map.containsKey(jobName)) {
  println "ERROR: project " + jobName + " exists"
  return 1;
}

// SCM with Git
project = Jenkins.instance.createProject(FreeStyleProject, jobName)
def gitScm = new GitSCM(url)
gitScm.branches = [new hudson.plugins.git.BranchSpec("*/pkislouski")]
project.scm = gitScm

// Delete workspace before build starts
project.buildWrappersList.add(new PreBuildCleanup(null, true, "", ""))

// Execute shell
project.buildersList.add(new Shell('echo hello'))

println "INFO: Script seed.groovy executed correctly. Now execute"
